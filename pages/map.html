<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>Aberdeen Traffic Viewer</title>

<!--- Styles -->
  <link rel="stylesheet" href="main.css">
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <link href="nouislider.min.css" rel="stylesheet">
  

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.3.1/leaflet.css" />

  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.3.1/leaflet.js"></script>


  <script src="https://unpkg.com/maplibre-gl@2.1.1/dist/maplibre-gl.js"></script>
  <link href="https://unpkg.com/maplibre-gl@2.1.1/dist/maplibre-gl.css" rel="stylesheet" />

  <script src = "slider.js"></script>
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.heat/0.2.0/leaflet-heat.js"></script>
  
  
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.0/papaparse.min.js"></script>


</head>







<body>

<!--NavBar-->

<nav class="w3-bar w3-black w3-card">
  <!-- Brand/logo -->
    <a class="navbar-brand " href="#"></a>
      <!-- Links -->
      <a href="Index.html" class="w3-bar-item w3-button w3-padding-large">HOME</a>
      <a href="Map.html" class="w3-bar-item w3-button w3-padding-large w3-hide-small">Map</a>
</nav>

<hr>




<div class="container" id = "mapContainer">
  <div class="row">
    <div class="col-sm-12">
      <div class="w3-content" id = "mapStyle">
            <div id="map"> 

              <hr>
            
                <a href="https://www.maptiler.com" style="position:absolute;left:10;bottom:10px;z-index:999;"><img src="https://api.maptiler.com/resources/logo.svg" alt="MapTiler logo"></a>
              
             
              <p><a href="https://www.maptiler.com/copyright/" target="_blank">© MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">© OpenStreetMap contributors</a></p>
              
              <script>
 


                var map = L.map('map').setView([57.1190254259, -2.13552223973], 1);
                L.tileLayer('https://api.maptiler.com/maps/streets/{z}/{x}/{y}.png?key=anuDqwGFecEjGf461O6C',{
                  tileSize: 512,
                  zoomOffset: -1,
                  minZoom: 1,
                  attribution: "\u003ca href=\"https://www.maptiler.com/copyright/\" target=\"_blank\"\u003e\u0026copy; MapTiler\u003c/a\u003e \u003ca href=\"https://www.openstreetmap.org/copyright\" target=\"_blank\"\u003e\u0026copy; OpenStreetMap contributors\u003c/a\u003e",
                  crossOrigin: true
                }).addTo(map);


                map.setView(new L.LatLng(57.146522, -2.099081), 15);
                
                var slider = document.getElementById('slider');

              

                  // Read markers data from data.csv
                  $.get('./Flow data - Union St/Test/combined-csv-files.csv', function(csvString) {

                  // Use PapaParse to convert string to array of objects
                  var data = Papa.parse(csvString, {header: true, dynamicTyping: true}).data;

                  // For each row in data, create a marker and add it to the map
                  // For each row, columns `Latitude`, `Longitude`, and `Amount` are required
                  var points = [];
                for (var i in data) {
                  var row = data[i];
                  if (row.Latitude) {
                    console.table(data[i]);

                    var lat = parseFloat(row.Latitude);
                    var lng = parseFloat(row.Longitude);
                    var amt = parseFloat(row.Amount);

                    points.push([lat, lng, amt]);

                    
                  }

                }

                var heat = L.heatLayer(points, {
                      radius:25,
                      gradient: {
                      0.00: 'rgb(0,0,255)',
                      0.25: 'rgb(0,0,255)',
                      0.50: 'rgb(0,255,0)',
                      0.75: 'rgb(255,255,0)',
                      1.00: 'rgb(255,0,0)'
                      },
                      minOpacity: 0.4,
                      blur: 15,
                      maxZoom: 15,
                    })

                    
                    

                  // var heat = L.heatLayer([
                  //   [57.1190254259, -2.13552223973, 0.2], // lat, lng, intensity
                  //   [57.1190254259, -2.14552223973, 0.3],
                  //   [57.1190254259, -2.15552223973, 0.4],
                  //   [57.1190254259, -2.16552223973, 0.5],
                  //   ], {
                  //   radius: 25,
                  //   gradient : {0.4: 'blue', 0.5: 'lime', 0.6: 'red'},
                  //   minOpacity : 0.23,
                  // })



                var airQualitiyMarker1 = L.circle ([57.1190254259, -2.13552223973],{
                    color: 'green',
                    fillColor: 'green',
                    fillOpacity: 0.5,
                    radius: 500
                })

                var airQualitiyMarker2 = L.circle ([57.1290254259, -2.13552223973],{
                    color: 'green',
                    fillColor: 'green',
                    fillOpacity: 0.5,
                    radius: 500
                })
                var airQualitiy = L.layerGroup([airQualitiyMarker1,airQualitiyMarker2]);
  


                var overlays = {
                  "Traffic": heat,
                  "Air Qualitiy": airQualitiy,
                }


                //Add layer control 
                L.control.layers(null, overlays).addTo(map);

});

               

            </script>
        
        </div>
    </div>
   
  </div>


 
</div>

<div class="row" id = pRow>
  <p>Select date to view data</p>
  <div class="col-sm-12">
    <div class="w3-content" id = "sliderStyle">
      <br>
  <input type = "range" min="1" max="100" value="1" id="myRange" class="slider" style="left:50px;top:1px;z-index:999;">
  <hr>
</div>
</div>

</div>



</div>

<footer class="page-footer font-small pt-4">

  <!-- Footer Content-->
  <div class="container-fluid text-center">
    <div class="row">
   

      <i class="fa fa-facebook-official w3-hover-opacity"></i>
      <i class="fa fa-instagram w3-hover-opacity"></i>
      <i class="fa fa-snapchat w3-hover-opacity"></i>
      <i class="fa fa-pinterest-p w3-hover-opacity"></i>
      <i class="fa fa-twitter w3-hover-opacity"></i>
      <i class="fa fa-linkedin w3-hover-opacity"></i>


  <!-- Footer Content -->
  
  <!-- Copyright -->
  <div class="footer-copyright text-center py-3">
    © 2022,
    <a href="Index.html"> Aberdeen Traffic Viewer</a>
  </div> 
</footer>
<!-- Footer End -->

</body>
</html>
