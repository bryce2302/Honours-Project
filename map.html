<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Aberdeen Traffic Viewer</title>
    <!--- Styles -->
    <link rel="stylesheet" href="main.css">
    <link rel="stylesheet" href="styles.css">

    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.3.1/leaflet.css" />



    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.3.1/leaflet.js"></script>
    <script src="https://unpkg.com/maplibre-gl@2.1.1/dist/maplibre-gl.js"></script>
    <link href="https://unpkg.com/maplibre-gl@2.1.1/dist/maplibre-gl.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.heat/0.2.0/leaflet-heat.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.0/papaparse.min.js"></script>
</head>



<body id="body">

         <!-- Navigation bar -->
         <header class="header">
            <!-- Logo -->
            <a href="index.html" class="logo">ATV</a>
            <!-- Hamburger icon -->
            <input class="side-menu" type="checkbox" id="side-menu"/>
            <label class="hamb" for="side-menu"><span class="hamb-line"></span></label>
            <!-- Menu -->
            <nav class="nav">
                <ul class="menu">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="map.html">Map</a> </li>
                </ul>
            </nav>
        </header>
        <!-- Main content -->


    <!--  SCript for getting dark mode on site -->
    <script>
        function darkMode() {
            var element = document.body;
            element.classList.toggle("dark-mode");

        }
    </script>

    <hr>
    <!-- Start Of conatiner for Map-->
    <div class="container" id="mapContainer">
        <div class="row">
            <div class="col-sm-12">
                <div class="w3-content" id="mapStyle">
                    <div id="map"></div>
                        <hr>
                        <a href="https://www.maptiler.com"
                            style="position:absolute;left:10;bottom:10px;z-index:999;"><img
                                src="https://api.maptiler.com/resources/logo.svg" alt="MapTiler logo"></a>
                        <p><a href="https://www.maptiler.com/copyright/" target="_blank">© MapTiler</a> <a
                                href="https://www.openstreetmap.org/copyright" target="_blank">© OpenStreetMap
                                contributors</a>
                        </p>
                        <!-- Script for getting the map -->
                        <script>
                            var map = L.map('map').setView([57.1190254259, -2.13552223973], 1);

                            //Adding tile layer
                            L.tileLayer('https://api.maptiler.com/maps/streets/{z}/{x}/{y}.png?key=anuDqwGFecEjGf461O6C', {
                                tileSize: 512,
                                zoomOffset: -1,
                                minZoom: 1,
                                attribution: "\u003ca href=\"https://www.maptiler.com/copyright/\" target=\"_blank\"\u003e\u0026copy; MapTiler\u003c/a\u003e \u003ca href=\"https://www.openstreetmap.org/copyright\" target=\"_blank\"\u003e\u0026copy; OpenStreetMap contributors\u003c/a\u003e",
                                crossOrigin: true
                            }).addTo(map);


                            //Setting where the map begins at when loaded in 
                            map.setView(new L.LatLng(57.146522, -2.099081), 13);
                            

                                // Read markers data from combined-csv-files.csv
                                $.get('./Flow data - Union St/2019/combine.csv', function (csvString) {

                                    // Use PapaParse to convert string to array of objects
                                    var data = Papa.parse(csvString, {
                                        header: true,
                                        dynamicTyping: true
                                    }).data;

                                    // For each row in data, create a marker and add it to the map
                                    // For each row, columns `Latitude`, `Longitude`, and `Amount` are required
                                    heat1Points = [];
                                    for (var i in data) {
                                        var row = data[i];
                                        //Check if the row conatisn a Latitude
                                        if (row.Latitude) {
                                            console.table(data[i]);
                                        
                                            //Create three new variables to store the lat.long and amount from the csv at each row 
                                            var lat = parseFloat(row.Latitude);
                                            var lng = parseFloat(row.Longitude);
                                            var amt = parseFloat(row.Amount);
                                    
                                        
                                            //push these to the points array
                                            heat1Points.push([lat, lng, amt]);
           
                                        }
                                    }

                                    var heat1 = L.heatLayer(heat1Points, {
                                        gradient: {
                                                0.00: 'rgb(0,0,255)',
                                                0.25: 'rgb(0,0,255)',
                                                0.50: 'rgb(0,255,0)',
                                                0.75: 'rgb(255,255,0)',
                                                1.00: 'rgb(255,0,0)'
                                            },
                                            opacity: 50,
                                            blur: 15,
                                            maxZoom: 15,
                                            max: 250000,
                                            radius: 50
                                        })
                                        draw(heat1)
                                });

                                // Read markers data from combined-csv-files.csv
                                $.get('./Flow data - Union St/2020/combined-csv-files.csv', function (csvString) {

                                // Use PapaParse to convert string to array of objects
                                var data = Papa.parse(csvString, {
                                    header: true,
                                    dynamicTyping: true
                                }).data;

                                // For each row in data, create a marker and add it to the map
                                // For each row, columns `Latitude`, `Longitude`, and `Amount` are required
                                heat2Points = [];
                                for (var i in data) {
                                    var row = data[i];
                                    //Check if the row conatisn a Latitude
                                    if (row.Latitude) {
                                        console.table(data[i]);
                                    
                                        //Create three new variables to store the lat.long and amount from the csv at each row 
                                        var lat = parseFloat(row.Latitude);
                                        var lng = parseFloat(row.Longitude);
                                        var amt = parseFloat(row.Amount);

                                    
                                        //push these to the points array
                                        heat2Points.push([lat, lng, amt]);

                                    }
                                }

                                var heat2 = L.heatLayer(heat2Points, {
                                    gradient: {
                                            0.00: 'rgb(0,0,255)',
                                            0.25: 'rgb(0,0,255)',
                                            0.50: 'rgb(0,255,0)',
                                            0.75: 'rgb(255,255,0)',
                                            1.00: 'rgb(255,0,0)'
                                        },
                                        opacity: 50,
                                        blur: 15,
                                        maxZoom: 15,
                                        max: 250000,
                                        radius: 50
                                    })
                                    draw(heat2)
                                });

                        
                           
                            function draw(heat1,heat2) {
                              
                                var airQualitiy= L.circle([57.149472, -2.097698], {
                                    color: 'green',
                                    fillColor: 'green',
                                    fillOpacity: 0.5,
                                    radius: 3000
                                })

                            
                                // Assign the heat markers adn air quality to the layer control
                                
                                var overlays = {
                                    "Traffic": heat1,
                                    "Air Qualitiy": airQualitiy
                                };
  
                                var control = L.control.layers(null,overlays)
                                //Add layer control 

                                control.addTo(map);

                            }



                        
     

                        </script>
                    </div>
                </div>
            </div>
            
        </div>
    </div>

    <footer class="page-footer">
        <div class="footer-copyright text-center py-3">
        <!-- Footer Content-->
        <div class="container-fluid text-center">
            <div class="row justify-content-center">
                <div class="col-4">


                    <a class="fa fa-facebook-official w3-hover-opacity" href="https://www.facebook.com/bryce.dawson.526/"></a>

                    <a class="fa fa-instagram w3-hover-opacity" href="https://www.instagram.com/bryce_2302/?hl=en"></a>

                    <a class="fa fa-twitter w3-hover-opacity"  href="https://twitter.com/bryce_2302"></a>
                   

                    <!-- Footer Content -->

                    <!-- Copyright -->
                    
                        © 2022,
                        <a href="index.html"> Aberdeen Traffic Viewer</a>
                        </di v>
                        </di v>
                        </di v>

                    </div>
                </div>
                    </footer>

</body>

</html>